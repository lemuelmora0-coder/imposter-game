<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IMPOSTEE: Neural Link</title>
    <style>
        :root { --glow: #00d4ff; --bg: #0a0e14; --card: #151d29; --text: #e0e6ed; --danger: #ff4757; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); text-align: center; padding: 20px; user-select: none; }
        .card { background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid #30363d; display: inline-block; width: 90%; max-width: 450px; }
        input, select { background: #0d1117; border: 1px solid #30363d; color: var(--glow); padding: 12px; border-radius: 8px; width: 85%; margin: 10px 0; font-size: 1rem; }
        button { background: var(--glow); color: #000; font-weight: bold; border: none; padding: 15px; border-radius: 10px; cursor: pointer; width: 100%; margin-top: 15px; text-transform: uppercase; }
        .word-box { font-size: 2.2rem; font-weight: 900; margin: 30px 0; min-height: 60px; color: var(--danger); transition: 0.2s; }
        .hold-btn { background: #30363d; color: white; padding: 25px; border: 2px dashed var(--glow); border-radius: 15px; cursor: pointer; touch-action: manipulation; }
        .hold-btn:active { background: var(--glow); color: black; box-shadow: 0 0 20px var(--glow); }
        .hidden { display: none !important; }
        .deck-list { text-align: left; margin: 10px 0; font-size: 0.9rem; color: #8b949e; }
    </style>
</head>
<body>

    <div id="setup-screen" class="card">
        <h2>/// SYSTEM SETUP ///</h2>
        <div class="deck-list">LOAD PREVIOUS DECK:</div>
        <select id="saved-decks-dropdown" onchange="loadDeck()">
            <option value="">-- New Deck --</option>
        </select>
        <p>DECK NAME:</p>
        <input type="text" id="deck-name" placeholder="e.g. Robotics">
        <p>WORDS (Comma separated):</p>
        <input type="text" id="custom-words" placeholder="Word1, Word2, Word3">
        <button onclick="startGame()">INITIALIZE LINK</button>
    </div>

    <div id="game-screen" class="card hidden">
        <h3 id="player-turn-text">UNIT 1 READY</h3>
        <div id="word-display" class="word-box">****</div>
        <div id="hold-trigger" class="hold-btn">HOLD TO DECRYPT</div>
        <button id="next-btn" class="hidden" onclick="nextPlayer()">DONE & PASS</button>
    </div>

    <div id="reveal-screen" class="card hidden">
        <h2 style="color: var(--danger);">/// ANOMALY DETECTED ///</h2>
        <div id="impostor-reveal" class="word-box" style="color: var(--glow);">?</div>
        <button onclick="location.reload()">REBOOT</button>
    </div>

    <audio id="snd-reveal" src="PASTE_YOUR_LINK_HERE"></audio>
    <audio id="snd-pass" src="PASTE_YOUR_LINK_HERE"></audio>

    <script>
        let players = [];
        let currentPlayerIndex = 0;
        let impostorName = "";
        let decks = JSON.parse(localStorage.getItem('impostee_decks')) || {};

        // Initialization
        window.onload = () => {
            const dropdown = document.getElementById('saved-decks-dropdown');
            for (let name in decks) {
                let opt = document.createElement('option');
                opt.value = name;
                opt.innerHTML = name;
                dropdown.appendChild(opt);
            }
        };

        function loadDeck() {
            const name = document.getElementById('saved-decks-dropdown').value;
            if (decks[name]) {
                document.getElementById('deck-name').value = name;
                document.getElementById('custom-words').value = decks[name];
            }
        }

        function startGame() {
            const name = document.getElementById('deck-name').value;
            const words = document.getElementById('custom-words').value;
            const count = parseInt(prompt("Number of Players?", "3"));

            if (!name || !words) return alert("Enter deck details!");

            // Save deck to LocalStorage
            decks[name] = words;
            localStorage.setItem('impostee_decks', JSON.stringify(decks));

            const wordList = words.split(',').map(w => w.trim());
            const secret = wordList[Math.floor(Math.random() * wordList.length)];
            const impIdx = Math.floor(Math.random() * count);
            impostorName = `UNIT ${impIdx + 1}`;

            players = Array.from({length: count}, (_, i) => 
                i === impIdx ? "IMPOSTOR" : secret
            );

            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            updateUI();
        }

        function updateUI() {
            if (currentPlayerIndex >= players.length) {
                document.getElementById('game-screen').classList.add('hidden');
                document.getElementById('reveal-screen').classList.remove('hidden');
                document.getElementById('impostor-reveal').innerText = impostorName;
                return;
            }
            document.getElementById('player-turn-text').innerText = `UNIT ${currentPlayerIndex + 1}`;
            document.getElementById('word-display').innerText = "****";
            document.getElementById('hold-trigger').classList.remove('hidden');
            document.getElementById('next-btn').classList.add('hidden');
        }

        // HOLD TO REVEAL LOGIC
        const trigger = document.getElementById('hold-trigger');
        const display = document.getElementById('word-display');
        const nextBtn = document.getElementById('next-btn');

        function showWord() {
            display.innerText = players[currentPlayerIndex];
            display.style.color = players[currentPlayerIndex] === "IMPOSTOR" ? "var(--danger)" : "var(--glow)";
            document.getElementById('snd-reveal').play();
        }

        function hideWord() {
            display.innerText = "****";
            display.style.color = "var(--danger)";
            trigger.classList.add('hidden');
            nextBtn.classList.remove('hidden');
        }

        trigger.addEventListener('mousedown', showWord);
        trigger.addEventListener('touchstart', (e) => { e.preventDefault(); showWord(); });
        trigger.addEventListener('mouseup', hideWord);
        trigger.addEventListener('touchend', hideWord);

        function nextPlayer() {
            document.getElementById('snd-pass').play();
            currentPlayerIndex++;
            updateUI();
        }
    </script>
</body>
</html>
