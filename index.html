<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ST VINCENT: Impostor</title>
    <style>
        :root { --glow: #00d4ff; --bg: #0a0e14; --card: #151d29; --text: #e0e6ed; --danger: #ff4757; --warning: #f1c40f; }
        
        /* --- GALAXY BACKGROUND --- */
        html, body { height: 100%; margin: 0; overflow: hidden; background: #090A0F; }
        body { font-family: 'Segoe UI', sans-serif; color: var(--text); text-align: center; user-select: none; display: flex; justify-content: center; align-items: center; }
        
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        .stars-1 { background: transparent; box-shadow: 444px 111px #FFF, 123px 456px #FFF, 890px 234px #FFF, 500px 700px #FFF, 1500px 300px #FFF; width: 1px; height: 1px; animation: animStar 60s linear infinite; }
        .stars-1:after { content: " "; position: absolute; top: 2000px; width: 1px; height: 1px; box-shadow: inherit; }
        @keyframes animStar { from { transform: translateY(0px); } to { transform: translateY(-2000px); } }
        
        /* --- UI COMPONENTS --- */
        .content-wrapper { z-index: 10; position: relative; width: 100%; padding: 20px; }
        .card { background: rgba(21, 29, 41, 0.9); backdrop-filter: blur(15px); padding: 30px; border-radius: 20px; border: 1px solid #30363d; display: inline-block; width: 90%; max-width: 450px; box-shadow: 0 10px 40px rgba(0,0,0,0.9); }
        
        h2 { color: var(--glow); text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 10px var(--glow); font-size: 1.2rem; }
        input, select { background: rgba(13, 17, 23, 0.9); border: 1px solid #30363d; color: var(--glow); padding: 12px; border-radius: 8px; width: 85%; margin: 8px 0; font-size: 0.95rem; outline: none; }
        
        button { background: var(--glow); color: #000; font-weight: bold; border: none; padding: 16px; border-radius: 12px; cursor: pointer; width: 100%; margin-top: 15px; text-transform: uppercase; transition: 0.3s; }
        button:hover { transform: scale(1.02); box-shadow: 0 0 20px var(--glow); }
        
        .word-box { font-size: 2.2rem; font-weight: 900; margin: 25px 0; min-height: 60px; color: var(--danger); text-shadow: 0 0 15px var(--danger); }
        .hold-btn { background: rgba(48, 54, 61, 0.7); color: white; padding: 30px; border: 2px dashed var(--glow); border-radius: 15px; cursor: pointer; touch-action: manipulation; font-weight: bold; }
        .hold-btn:active { background: var(--glow); color: black; box-shadow: 0 0 30px var(--glow); border-style: solid; }
        
        .warning-text { color: var(--warning); font-weight: bold; text-transform: uppercase; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
        .hidden { display: none !important; }
        
        /* Splash Screen Style */
        #splash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #090A0F; z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    </style>
</head>
<body>

    <div id="splash-screen">
        <h1 style="color: var(--glow); text-shadow: 0 0 15px var(--glow);">ST VINCENT PROTOCOL</h1>
        <button onclick="initApp()" style="width: 200px;">ENTER SYSTEM</button>
    </div>

    <div class="stars stars-1"></div>

    <div class="content-wrapper">
        <div id="setup-screen" class="card hidden">
            <h2>ST VINCENT, WHO'S THE IMPOSTOR</h2>
            <select id="saved-decks-dropdown" onchange="loadDeck()">
                <option value="">-- Load Saved Deck --</option>
            </select>
            <input type="text" id="deck-name" placeholder="Deck Name">
            <input type="text" id="custom-words" placeholder="Words (e.g. Arduino, Sensor, Motor)">
            <input type="number" id="player-count" placeholder="Total Players" min="3" value="3">
            <input type="number" id="impostor-count" placeholder="Number of Impostors" min="1" value="1">
            <button onclick="startGame()">INITIALIZE LINK</button>
        </div>

        <div id="game-screen" class="card hidden">
            <h3 id="player-turn-text">UNIT 1 READY</h3>
            <div id="word-display" class="word-box">****</div>
            <div id="hold-trigger" class="hold-btn">HOLD TO DECRYPT</div>
            <button id="next-btn" class="hidden" onclick="nextPlayer()">DONE & PASS</button>
        </div>

        <div id="warning-screen" class="card hidden">
            <h2 class="warning-text">PROTOCOL COMPLETE</h2>
            <p>ALL UNITS HAVE BEEN BRIEFED.</p>
            <button onclick="finalReveal()" style="background: var(--danger); color: white;">FINAL REVEAL</button>
        </div>

        <div id="reveal-screen" class="card hidden">
            <h2 style="color: var(--danger);">/// ANOMALIES DETECTED ///</h2>
            <div id="impostor-reveal" class="word-box" style="color: var(--glow); font-size: 1.5rem;">?</div>
            <button onclick="location.reload()">REBOOT SYSTEM</button>
        </div>
    </div>

    <audio id="snd-bgm" src="lofibg.mp3" loop></audio>

    <script>
        let players = [];
        let currentPlayerIndex = 0;
        let impostors = [];
        let decks = JSON.parse(localStorage.getItem('impostee_decks')) || {};

    const preinstalledDecks = {
            "Filipino Memes": "Skusta Clee, Forda Ferson, You're Road, Na-ol, Ssob, Pinoy Big Brother, Marites, Civil Service Exam, 2Joints, Diwata Pares, Boss Mapagmahal, Ivana Alawi, Small Laude, Otlum, Carlos Yulo, Alice Guo, Pura Luka Vega, Toni Fowler, Zeinab Harake, Cong TV, Viy Cortez, Junnie Boy, Team Payaman, Batang Quiapo, Cardo Dalisay, Probinsyano, Kapuso, Kapamilya, Kapatid, KMJS, Ed Caluag, Jessica Soho, Rated K, Korina Sanchez, Noli De Castro, Ted Failon, Vice Ganda, It's Showtime, Eat Bulaga, JoWaPao, Maine Mendoza, Alden Richards, AlDub, KathNiel, LizQuen, JaDine, BarDa, DonBelle, Kyline Alcantara, Andrea Brillantes, Seth Fedelin, Francine Diaz, BINI, SB19, Pantropiko, Gento, Bazinga, Salamat Dok, Tulfo, Raffy Tulfo in Action, Marites University, Ogie Diaz, Xian Gaza, Valentine Rosales, Rendon Labador, Motivation, Galawan, Pa-fall, Ghosting, Gaslighting, Situationship, Delulu, Red Flag, Green Flag, Main Character, Side Character, POV, Plot Twist, Canon Event, Lowkey, Highkey, Flex, Slay, Yas Queen, Bestie, Bhie, Mima, Mars, Kumusta Ka, Pa-mine, Budol, Add to Cart, Shopee, Lazada, TikTok Shop, Flash Sale, 12.12, Free Shipping, COD, Rider.",
            
            "Anime": "Naruto, Sasuke, Sakura, Kakashi, Hinata, Itachi, Madara, Luffy, Zoro, Nami, Sanji, Chopper, Robin, Brook, Franky, Jimbei, Goku, Vegeta, Gohan, Piccolo, Frieza, Cell, Majin Buu, Eren Yeager, Mikasa, Armin, Levi, Erwin, Reiner, Tanjiro, Nezuko, Zenitsu, Inosuke, Muzan, Rengoku, Shinobu, Deku, Bakugo, Todoroki, All Might, Shigaraki, Toga, Anya Forger, Loid Forger, Yor Forger, Bond, Saitama, Genos, Boros, Garou, Tatsumaki, Fubuki, Light Yagami, L, Ryuk, Misa, Near, Mello, Edward Elric, Alphonse, Mustang, Winry, Scar, Gon, Killua, Kurapika, Leorio, Hisoka, Chrollo, Rimuru, Milim, Veldora, Shion, Benimaru, Asta, Yuno, Noelle, Yami, Julius, Spike Spiegel, Faye Valentine, Jet Black, Ed, Ein, Shinji Ikari, Rei Ayanami, Asuka, Misato, Kaworu, Yusuke Urameshi, Kuwabara, Kurama, Hiei, Genkai, Sailor Moon, Tuxedo Mask, Kenshin, Sanosuke, Kaoru, Saito, Shishio.",
            
            "Daily Things": "Toothbrush, Toothpaste, Soap, Shampoo, Towel, Mirror, Comb, Hair Dryer, Bed, Pillow, Blanket, Curtains, Electric Fan, Aircon, Television, Remote Control, Smartphone, Charger, Powerbank, Earphones, Laptop, Mouse, Keyboard, Desk, Chair, Backpack, Wallet, Keys, Shoes, Slippers, Umbrella, Water Bottle, Mug, Plate, Spoon, Fork, Knife, Frying Pan, Stove, Refrigerator, Microwave, Toaster, Coffee Maker, Rice Cooker, Washing Machine, Hanger, Laundry Basket, Iron, Ironing Board, Vacuum Cleaner, Broom, Dustpan, Mop, Trash Can, Clock, Calendar, Notebook, Pen, Pencil, Eraser, Scissors, Tape, Glue, Calculator, Stapler, Paper, Envelope, Stamps, Books, Glasses, Watch, Ring, Necklace, Earrings, Bracelet, Hat, Jacket, T-shirt, Pants, Socks, Underwear, Belt, Perfume, Deodorant, Lotion, Sunscreen, Alcohol, Face Mask, Vitamins, Medicine, Band-aid, First Aid Kit, Flashlight, Battery, Toolkit, Screwdriver, Hammer, Nails, Ladder."
        };
    
        let decks = JSON.parse(localStorage.getItem('impostee_decks')) || {};
        // Merge preinstalled into user decks for the session
        let allDecks = { ...preinstalledDecks, ...decks };
    
        function initApp() {
            document.getElementById('splash-screen').classList.add('hidden');
            document.getElementById('setup-screen').classList.remove('hidden');
            const bgm = document.getElementById('snd-bgm');
            bgm.volume = 0.3;
            bgm.play().catch(e => console.log("Audio Blocked", e));
        }

 window.onload = () => {
        const dropdown = document.getElementById('saved-decks-dropdown');
        for (let name in allDecks) {
            dropdown.add(new Option(name, name));
        }
    };

    function loadDeck() {
        const name = document.getElementById('saved-decks-dropdown').value;
        if (allDecks[name]) {
            document.getElementById('deck-name').value = name;
            document.getElementById('custom-words').value = allDecks[name];
        }
    }

    function startGame() {
        const name = document.getElementById('deck-name').value;
        const wordsInput = document.getElementById('custom-words').value;
        const pCount = parseInt(document.getElementById('player-count').value);
        const iCount = parseInt(document.getElementById('impostor-count').value);

        if (!name || !wordsInput || isNaN(pCount)) return alert("Data incomplete!");
        if (iCount >= pCount - 1) return alert("Too many impostors!");

        // Save only if it's a NEW custom deck (not preinstalled)
        if (!preinstalledDecks[name]) {
            decks[name] = wordsInput;
            localStorage.setItem('impostee_decks', JSON.stringify(decks));
        }

        const wordList = wordsInput.split(',').map(w => w.trim()).filter(w => w.length > 0);
        const secret = wordList[Math.floor(Math.random() * wordList.length)];
        
        let indices = Array.from({length: pCount}, (_, i) => i);
        impostors = [];
        for(let i=0; i<iCount; i++) {
            let randomIdx = Math.floor(Math.random() * indices.length);
            impostors.push(indices.splice(randomIdx, 1)[0] + 1);
        }

        players = Array.from({length: pCount}, (_, i) => 
            impostors.includes(i + 1) ? "IMPOSTOR" : secret
        );

        document.getElementById('setup-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        updateUI();
    }
        function updateUI() {
            document.getElementById('player-turn-text').innerText = `UNIT ${currentPlayerIndex + 1} READY`;
            document.getElementById('word-display').innerText = "****";
            document.getElementById('word-display').style.color = "var(--danger)";
            document.getElementById('hold-trigger').classList.remove('hidden');
            document.getElementById('next-btn').classList.add('hidden');
        }

        const trigger = document.getElementById('hold-trigger');
        const display = document.getElementById('word-display');

        function show() {
            display.innerText = players[currentPlayerIndex];
            display.style.color = players[currentPlayerIndex] === "IMPOSTOR" ? "var(--danger)" : "var(--glow)";
        }
        function hide() {
            display.innerText = "****";
            display.style.color = "var(--danger)";
            trigger.classList.add('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
        }

        trigger.addEventListener('mousedown', show);
        trigger.addEventListener('touchstart', (e) => { e.preventDefault(); show(); });
        trigger.addEventListener('mouseup', hide);
        trigger.addEventListener('touchend', hide);

        function nextPlayer() {
            currentPlayerIndex++;
            if (currentPlayerIndex < players.length) {
                updateUI();
            } else {
                document.getElementById('game-screen').classList.add('hidden');
                document.getElementById('warning-screen').classList.remove('hidden');
            }
        }

        function finalReveal() {
            document.getElementById('warning-screen').classList.add('hidden');
            document.getElementById('reveal-screen').classList.remove('hidden');
            document.getElementById('impostor-reveal').innerText = "Units: " + impostors.join(", ");
        }
    </script>
</body>
</html>

